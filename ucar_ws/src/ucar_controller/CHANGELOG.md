
## 串口通讯协议(20200416)：

### 1. 帧定义
#### 1.1 STM32 Write数据帧

|     |起始位 |指令版本|数据长度|里程脉冲|电池百分比|校验和|
|-----|------|-------|------|-------|--------|-----|
|字节数|   2  |   1   |   1  |   8   |    1   |  1  |
|数值  |  A   |   B   |   C  |   D   |   E    |  F  | 

A: 起始位: 0x63(l) 0x76(h)
B: 指令版本: 待定=============================
C: 数据长度: `里程脉冲` + `电池百分比` 的数据长度。
D: 里程脉冲:4个轮式里程计的脉冲数据。数值代表每个通讯周期内编码器累计的脉冲读数（正负区分正反转）。
```cpp
int16_t pluse_w1;
int16_t pluse_w2;
int16_t pluse_w3;
int16_t pluse_w4;
```
> 注：该版本电机编码率为270（一圈输出270个脉冲）

E: 电池百分比：剩余电量百分比（估计值）。
F: 校验和:`起始位`+`指令版本`+`数据长度`+`里程脉冲`+`电池百分比`

#### 1.2 STM32 READ数据帧

|     |起始位 |指令版本|数据长度|里程脉冲|LED控制  |校验和|
|-----|------|-------|------|-------|--------|-----|
|字节数|   2  |   1   |   1  |   8   |    3   |  1  |
|数值  |  A   |   B   |   C  |   D   |   E    |  F  | 

A: 起始位: 0x63(l) 0x75(h)
B: 指令版本: 待定=============================
C: 数据长度: `里程脉冲` + `LED控制`的数据长度。
D: 里程脉冲:4个轮式里程计的脉冲数据。数值代表每个通讯周期内编码器累计的脉冲读数（正负区分正反转）。
```cpp
int16_t pluse_w1;
int16_t pluse_w2;
int16_t pluse_w3;
int16_t pluse_w4;
```
E: LED的rgb控制
```cpp
uint8_t  green_value;
uint8_t  red_value;
uint8_t  blue_value;
```
F: 校验和:`起始位`+`指令版本`+`数据长度`+`里程脉冲`+`LED控制`

#### 1.3 校验和函数
```cpp
bool checkCS(int len){
  uint8_t cs = 0;
	for (size_t i = 0; i < len - 1; i++)
	{
		cs += pack_read_[i];
	}
  return pack_read_[len - 1] == cs;
}
void setCS(int len)
{
	uint8_t cs = 0x00;
	for (size_t i = 0; i < len - 1; i++)
	{
		cs += pack_write_[i];
	}
	pack_write_[len - 1] = cs;
}
```